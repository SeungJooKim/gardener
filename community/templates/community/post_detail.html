{% extends "base.html" %}
{% load static %}

{% block content %}
    <p><a href="{% url 'community:post_update' post.pk %}">포스트 수정</a></p>
    <p><a href="{% url 'community:post_delete' post.pk %}">포스트 삭제</a></p>
    <div>
        <p> {{post.user_id}}</p>
    </div>
    <h1>{{ post.title }}</h1>
    <div>
        {{ post.content|safe }}
    </div>

    {% for tag in post.tags.all %}
        <span>#{{tag.name}}</span>
    {% endfor %}
    <div class='likes post-id-{{ post.id }}'>
        {% if user.pk in liked_user %}
            <span><button class = 'heart' onclick="onClickLike({{ post.id }})">❤️</button></span>
            <span class='like_num'>좋아요 {{post.like_set.all.count}}</span>
        {% else %}
            <span><button class = 'heart' onclick="onClickLike({{ post.id }})">🤍</button></span>
            <span class='like_num'>좋아요 {{post.like_set.all.count}}</span>
        {% endif %}
    </div>

    <h2>Add a new comment</h2>
    <form action="." method="post">
        {% csrf_token %}
        {{comment_form.media}}
        {{ comment_form.as_p }}
        <button type="submit">Add comment</button>
    </form>


    {% for comment in comments %}
    <div class="comment" style="background-color: powderblue">
        <p class="info">{{ comment.content|safe}} | {{ comment.created_at }}</p>

        {% for replay in comment.replies.all %}
        <p class="info">{{ replay.content }} | {{ replay.created_at }}</p>
        {% endfor %}

        <h5>Replay</h5>
        <form action="." method="post">
            {% csrf_token %}
            {{comment_form.media}}
            {{ comment_form.as_p }}

            <input type="hidden" name="parent_id" value="{{ comment.id }}">
            <input class="btn btn-primary" type="submit" value="Replay">
        </form>
    </div>
    {% empty %}
    <h4>There are no comments yet.</h4>
    {% endfor %}
{% endblock %}

{% block js %}
    <script src="{% static 'javascripts/post_comment.js' %}"></script>
    <script src="{% static 'javascripts/likes.js' %}"></script>
{% endblock %}